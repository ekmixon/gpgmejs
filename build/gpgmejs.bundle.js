var Gpgmejs=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);const r={encrypt:{pinentry:!0,required:{keys:{allowed:["string"],array_allowed:!0},data:{allowed:["string"]}},optional:{protocol:{allowed:["string"],allowed_data:["cms","openpgp"]},signing_keys:{allowed:["string"],array_allowed:!0},base64:{allowed:["boolean"]},mime:{allowed:["boolean"]},armor:{allowed:["boolean"]},"always-trust":{allowed:["boolean"]},"no-encrypt-to":{allowed:["string"],array_allowed:!0},"no-compress":{allowed:["boolean"]},"throw-keyids":{allowed:["boolean"]},"want-address":{allowed:["boolean"]},wrap:{allowed:["boolean"]}},answer:{type:["ciphertext"],data:{data:"string",base64:"boolean"}}},decrypt:{pinentry:!0,required:{data:{allowed:["string"]}},optional:{protocol:{allowed:["string"],allowed_data:["cms","openpgp"]},base64:{allowed:["boolean"]}},answer:{type:["plaintext"],data:{data:"string",base64:"boolean",mime:"boolean",signatures:"object"}}},sign:{pinentry:!0,required:{data:{allowed:["string"]},keys:{allowed:["string"],array_allowed:!0}},optional:{protocol:{allowed:["string"],allowed_data:["cms","openpgp"]},sender:{allowed:["string"]},mode:{allowed:["string"],allowed_data:["detached","clearsign"]},base64:{allowed:["boolean"]},armor:{allowed:["boolean"]}},answer:{type:["signature","ciphertext"],data:{data:"string",base64:"boolean"}}},keylist:{required:{},optional:{protocol:{allowed:["string"],allowed_data:["cms","openpgp"]},secret:{allowed:["boolean"]},extern:{allowed:["boolean"]},local:{allowed:["boolean"]},sigs:{allowed:["boolean"]},notations:{allowed:["boolean"]},tofu:{allowed:["boolean"]},ephemeral:{allowed:["boolean"]},validate:{allowed:["boolean"]},keys:{allowed:["string"],array_allowed:!0}},answer:{type:["keys"],data:{base64:"boolean",keys:"object"}}},export:{required:{},optional:{protocol:{allowed:["string"],allowed_data:["cms","openpgp"]},keys:{allowed:["string"],array_allowed:!0},armor:{allowed:["boolean"]},extern:{allowed:["boolean"]},minimal:{allowed:["boolean"]},raw:{allowed:["boolean"]},pkcs12:{allowed:["boolean"]}},answer:{type:["keys"],data:{data:"string",base64:"boolean"}}},import:{required:{data:{allowed:["string"]}},optional:{protocol:{allowed:["string"],allowed_data:["cms","openpgp"]},base64:{allowed:["boolean"]}},answer:{type:[],data:{result:"object"}}},delete:{pinentry:!0,required:{key:{allowed:["string"]}},optional:{protocol:{allowed:["string"],allowed_data:["cms","openpgp"]}},answer:{data:{success:"boolean"}}},version:{required:{},optional:{},answer:{type:[""],data:{gpgme:"string",info:"object"}}},createkey:{pinentry:!0,required:{userid:{allowed:["string"]}},optional:{algo:{allowed:["string"]},expires:{allowed:["number"]}},answer:{type:[""],data:{fingerprint:"string"}}},verify:{required:{data:{allowed:["string"]}},optional:{protocol:{allowed:["string"],allowed_data:["cms","openpgp"]},signature:{allowed:["string"]},base64:{allowed:["boolean"]}},answer:{type:["plaintext"],data:{data:"string",base64:"boolean",info:"object"}}},config_opt:{required:{component:{allowed:["string"]},option:{allowed:["string"]}},optional:{},answer:{type:[],data:{option:"object"}}}},o={CONN_NO_CONNECT:{msg:"Connection with the nativeMessaging host could not be established.",type:"error"},CONN_EMPTY_GPG_ANSWER:{msg:"The nativeMessaging answer was empty.",type:"error"},CONN_TIMEOUT:{msg:"A connection timeout was exceeded.",type:"error"},CONN_UNEXPECTED_ANSWER:{msg:"The answer from gnupg was not as expected.",type:"error"},CONN_ALREADY_CONNECTED:{msg:"A connection was already established.",type:"warning"},MSG_INCOMPLETE:{msg:"The Message did not match the minimum requirements for the interaction.",type:"error"},MSG_EMPTY:{msg:"The Message is empty.",type:"error"},MSG_WRONG_OP:{msg:"The operation requested could not be found",type:"error"},MSG_NO_KEYS:{msg:"There were no valid keys provided.",type:"warning"},MSG_NOT_A_FPR:{msg:"The String is not an accepted fingerprint",type:"warning"},KEY_INVALID:{msg:"Key object is invalid",type:"error"},KEY_NOKEY:{msg:"This key does not exist in GPG",type:"error"},KEY_NO_INIT:{msg:"This property has not been retrieved yet from GPG",type:"error"},KEY_NO_DEFAULT:{msg:"A default key could not be established. Please check yout gpg configuration",type:"error"},SIG_WRONG:{msg:"A malformed signature was created",type:"error"},SIG_NO_SIGS:{msg:"There were no signatures found",type:"error"},PARAM_WRONG:{msg:"Invalid parameter was found",type:"error"},PARAM_IGNORED:{msg:"An parameter was set that has no effect in gpgmejs",type:"warning"},GENERIC_ERROR:{msg:"Unspecified error",type:"error"}};function i(e="GENERIC_ERROR",t){return o.hasOwnProperty(e)?"error"===o[e].type?new s(e):("warning"===o[e].type&&console.warn(e+": "+o[e].msg),null):"GNUPG_ERROR"===e?new s(e,t):new s("GENERIC_ERROR")}class s extends Error{constructor(e,t=""){"GNUPG_ERROR"===e&&"string"==typeof t?super(t):o.hasOwnProperty(e)?super(t?o[e].msg+"--"+t:o[e].msg):super(o.GENERIC_ERROR.msg),this.code=e||"GENERIC_ERROR"}set code(e){this._code=e}get code(){return this._code}}class a{constructor(){this.connect()}checkConnection(e=!0){if(!0===e)return this.post(u("version"));{let e=this;return new Promise(function(t){Promise.race([e.post(u("version")),new Promise(function(e,t){setTimeout(function(){t(i("CONN_TIMEOUT"))},500)})]).then(function(){t(!0)},function(){t(!1)})})}}disconnect(){this._connection&&(this._connection.disconnect(),this._connection=null)}connect(){this._connection||(this._connection=chrome.runtime.connectNative("gpgmejson"))}post(e){if(!(e&&e instanceof c))return this.disconnect(),Promise.reject(i("PARAM_WRONG","Connection.post"));if(!0!==e.isComplete)return this.disconnect(),Promise.reject(i("MSG_INCOMPLETE"));let t=this,n=e.chunksize;return new Promise(function(o,s){let a=new l(e),u=function(e){if(e){let r=a.collect(e);!0!==r?(t._connection.onMessage.removeListener(u),t._connection.disconnect(),s(r)):!0===e.more?t._connection.postMessage({op:"getmore",chunksize:n}):(t._connection.onMessage.removeListener(u),t._connection.disconnect(),a.message instanceof Error?s(a.message):o(a.message))}else t._connection.onMessage.removeListener(u),t._connection.disconnect(),s(i("CONN_EMPTY_GPG_ANSWER"))};return t._connection.onMessage.addListener(u),r[e.operation].pinentry?t._connection.postMessage(e.message):Promise.race([t._connection.postMessage(e.message),function(e,n){setTimeout(function(){t._connection.disconnect(),n(i("CONN_TIMEOUT"))},5e3)}]).then(function(e){return e},function(e){return e instanceof Error?e:(t._connection.disconnect(),i("GNUPG_ERROR",e))})})}}class l{constructor(e){this.operation=e.operation,this.expect=e.expect}collect(e){return"object"==typeof e&&e.hasOwnProperty("response")?void 0===this._responseb64?(this._responseb64=e.response,!0):(this._responseb64+=e.response,!0):i("CONN_UNEXPECTED_ANSWER")}get message(){if(void 0===this._responseb64)return i("CONN_UNEXPECTED_ANSWER");let e=JSON.parse(atob(this._responseb64)),t={},n=Object.keys(e),o=r[this.operation].answer;if(0===n.length)return i("CONN_UNEXPECTED_ANSWER");for(let r=0;r<n.length;r++){let s=n[r];switch(s){case"type":if("error"===e.type)return i("GNUPG_ERROR",e.msg);if(o.type.indexOf(e.type)<0)return i("CONN_UNEXPECTED_ANSWER");break;case"base64":break;case"msg":if("error"===e.type)return i("GNUPG_ERROR",e.msg);break;default:if(!o.data.hasOwnProperty(s))return i("CONN_UNEXPECTED_ANSWER");if(typeof e[s]!==o.data[s])return i("CONN_UNEXPECTED_ANSWER");!0===e.base64&&"string"===o.data[s]&&void 0===this.expect?t[s]=decodeURIComponent(atob(e[s]).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join("")):t[s]=e[s]}}return t}}function u(e){return"string"!=typeof e?i("PARAM_WRONG"):r.hasOwnProperty(e)?new c(e):i("MSG_WRONG_OP")}class c{constructor(e){this.operation=e}set operation(e){"string"==typeof e&&(this._msg||(this._msg={}),!this._msg.op&r.hasOwnProperty(e)&&(this._msg.op=e))}get operation(){return this._msg.op}set chunksize(e){Number.isInteger(e)&&e>10240&&e<=1048576&&(this._chunksize=e)}get chunksize(){return void 0===this._chunksize?1047552:this._chunksize}set expect(e){"base64"===e&&(this._expect=e)}get expect(){if("base64"===this._expect)return this._expect}setParameter(e,t){if(!e||"string"!=typeof e)return i("PARAM_WRONG");let n=r[this._msg.op];if(!n)return i("MSG_WRONG_OP");let o=null;if(n.required.hasOwnProperty(e))o=n.required[e];else{if(!n.optional.hasOwnProperty(e))return i("PARAM_WRONG");o=n.optional[e]}let s=function(e){switch(typeof e){case"string":return o.allowed.indexOf(typeof e)>=0&&e.length>0||i("PARAM_WRONG");case"number":return o.allowed.indexOf("number")>=0&&!1===isNaN(t)||i("PARAM_WRONG");case"boolean":return o.allowed.indexOf("boolean")>=0||i("PARAM_WRONG");case"object":if(!Array.isArray(e))return e instanceof Uint8Array&&o.allowed.indexOf("Uint8Array")>=0||i("PARAM_WRONG");if(!0!==o.array_allowed)return i("PARAM_WRONG");for(let t=0;t<e.length;t++){let n=s(e[t]);if(!0!==n)return n}if(e.length>0)return!0;break;default:return i("PARAM_WRONG")}},a=s(t);return!0!==a?a:o.hasOwnProperty("allowed_data")&&o.allowed_data.indexOf(t)<0?i("PARAM_WRONG"):(this._msg[e]=t,!0)}get isComplete(){if(!this._msg.op)return!1;let e=Object.keys(r[this._msg.op].required),t=Object.keys(this._msg);for(let n=0;n<e.length;n++)if(t.indexOf(e[n])<0)return!1;return!0}get message(){return!0===this.isComplete?(this._msg.chunksize=this.chunksize,this._msg):null}post(){let e=this;return new Promise(function(t,n){if(!0===e.isComplete){let r=new a;void 0===e._msg.chunksize&&(e._msg.chunksize=1047552),r.post(e).then(function(e){t(e)},function(e){n(e)})}else n(i("MSG_INCOMPLETE"))})}}function f(e){return w(e)?new p(e):i("PARAM_WRONG")}class p{constructor(e){this.fingerprint=e}set fingerprint(e){!0===w(e)&&(void 0===this._data?this._data={fingerprint:e}:void 0===this._data.fingerprint&&(this._data.fingerprint=e))}get fingerprint(){return this._data&&this._data.fingerprint?this._data.fingerprint:i("KEY_INVALID")}setKeyData(e){if(void 0===this._data&&(this._data={}),"object"!=typeof e)return i("KEY_INVALID");if(!this._data.fingerprint&&w(e.fingerprint)){if(e.fingerprint!==this.fingerprint)return i("KEY_INVALID");this._data.fingerprint=e.fingerprint}else if(this._data.fingerprint!==e.fingerprint)return i("KEY_INVALID");let t=Object.keys(e);for(let n=0;n<t.length;n++){if(!m.hasOwnProperty(t[n]))return i("KEY_INVALID");if(!0!==m[t[n]](e[t[n]]))return i("KEY_INVALID");switch(t[n]){case"subkeys":this._data.subkeys=[];for(let t=0;t<e.subkeys.length;t++)this._data.subkeys.push(new g(e.subkeys[t]));break;case"userids":this._data.userids=[];for(let t=0;t<e.userids.length;t++)this._data.userids.push(new d(e.userids[t]));break;case"last_update":this._data[t[n]]=new Date(1e3*e[t[n]]);break;default:this._data[t[n]]=e[t[n]]}}return this}get(e,t=!0){if(!1===t){let t=this;return new Promise(function(n,r){m.hasOwnProperty(e)?"armored"===e?n(t.getArmor()):"hasSecret"===e?n(t.getHasSecret()):t.refreshKey().then(function(t){n(t.get(e,!0))},function(e){r(e)}):r("PARAM_WRONG")})}return m.hasOwnProperty(e)?this._data.hasOwnProperty(e)?this._data[e]:i("KEY_NO_INIT"):i("PARAM_WRONG")}refreshKey(){let e=this;return new Promise(function(t,n){e._data.fingerprint||n(i("KEY_INVALID"));let r=u("keylist");r.setParameter("sigs",!0),r.setParameter("keys",e._data.fingerprint),r.post().then(function(r){1===r.keys.length?(e.setKeyData(r.keys[0]),t(e)):n(i("KEY_NOKEY"))},function(e){n(i("GNUPG_ERROR"),e)})})}getArmor(){let e=this;return new Promise(function(t,n){e._data.fingerprint||n(i("KEY_INVALID"));let r=u("export");r.setParameter("armor",!0),r.setParameter("keys",e._data.fingerprint),r.post().then(function(n){e._data.armored=n.data,t(n.data)},function(e){n(e)})})}getHasSecret(){let e=this;return new Promise(function(t,n){e._data.fingerprint||n(i("KEY_INVALID"));let r=u("keylist");r.setParameter("keys",e._data.fingerprint),r.setParameter("secret",!0),r.post().then(function(n){e._data.hasSecret=null,n.keys&&1===n.keys.length&&!0===n.keys[0].secret?(e._data.hasSecret=!0,t(!0)):(e._data.hasSecret=!1,t(!1))},function(e){n(e)})})}get armored(){return this.get("armored",!0)}get hasSecret(){return this.get("hasSecret",!0)}delete(){let e=this;return new Promise(function(t,n){e._data.fingerprint||n(i("KEY_INVALID"));let r=u("delete");r.setParameter("key",e._data.fingerprint),r.post().then(function(e){t(e.success)},function(e){n(e)})})}}class g{constructor(e){let t=Object.keys(e);for(let n=0;n<t.length;n++)this.setProperty(t[n],e[t[n]])}setProperty(e,t){this._data||(this._data={}),y.hasOwnProperty(e)&&!0===y[e](t)&&(this._data[e]="timestamp"===e||"expires"===e?new Date(1e3*t):t)}get(e){if(this._data.hasOwnProperty(e))return this._data[e]}}class d{constructor(e){let t=Object.keys(e);for(let n=0;n<t.length;n++)this.setProperty(t[n],e[t[n]])}setProperty(e,t){this._data||(this._data={}),_.hasOwnProperty(e)&&!0===_[e](t)&&(this._data[e]="last_update"===e?new Date(1e3*t):t)}get(e){if(this._data.hasOwnProperty(e))return this._data[e]}}const _={revoked:function(e){return"boolean"==typeof e},invalid:function(e){return"boolean"==typeof e},uid:function(e){return"string"==typeof e||""===e},validity:function(e){return"string"==typeof e},name:function(e){return"string"==typeof e||""===e},email:function(e){return"string"==typeof e||""===e},address:function(e){return"string"==typeof e||""===e},comment:function(e){return"string"==typeof e||""===e},origin:function(e){return Number.isInteger(e)},last_update:function(e){return Number.isInteger(e)}},y={invalid:function(e){return"boolean"==typeof e},can_encrypt:function(e){return"boolean"==typeof e},can_sign:function(e){return"boolean"==typeof e},can_certify:function(e){return"boolean"==typeof e},can_authenticate:function(e){return"boolean"==typeof e},secret:function(e){return"boolean"==typeof e},is_qualified:function(e){return"boolean"==typeof e},is_cardkey:function(e){return"boolean"==typeof e},is_de_vs:function(e){return"boolean"==typeof e},pubkey_algo_name:function(e){return"string"==typeof e},pubkey_algo_string:function(e){return"string"==typeof e},keyid:function(e){return function(e){return b(e,16)}(e)},pubkey_algo:function(e){return Number.isInteger(e)&&e>=0},length:function(e){return Number.isInteger(e)&&e>0},timestamp:function(e){return Number.isInteger(e)&&e>0},expires:function(e){return Number.isInteger(e)&&e>0}},m={fingerprint:function(e){return w(e)},armored:function(e){return typeof("string"===e)},revoked:function(e){return"boolean"==typeof e},expired:function(e){return"boolean"==typeof e},disabled:function(e){return"boolean"==typeof e},invalid:function(e){return"boolean"==typeof e},can_encrypt:function(e){return"boolean"==typeof e},can_sign:function(e){return"boolean"==typeof e},can_certify:function(e){return"boolean"==typeof e},can_authenticate:function(e){return"boolean"==typeof e},secret:function(e){return"boolean"==typeof e},is_qualified:function(e){return"boolean"==typeof e},protocol:function(e){return"string"==typeof e},issuer_serial:function(e){return"string"==typeof e},issuer_name:function(e){return"string"==typeof e},chain_id:function(e){return"string"==typeof e},owner_trust:function(e){return"string"==typeof e},last_update:function(e){return Number.isInteger(e)},origin:function(e){return Number.isInteger(e)},subkeys:function(e){return Array.isArray(e)},userids:function(e){return Array.isArray(e)},tofu:function(e){return Array.isArray(e)},hasSecret:function(e){return"boolean"==typeof e}};function h(e){if(!e)return[];Array.isArray(e)||(e=[e]);let t=[];for(let n=0;n<e.length;n++)if("string"==typeof e[n])!0===w(e[n])?t.push(e[n]):i("MSG_NOT_A_FPR");else{if("object"!=typeof e[n])return i("PARAM_WRONG");{let r="";e[n]instanceof p?r=e[n].fingerprint:e[n].hasOwnProperty("primaryKey")&&e[n].primaryKey.hasOwnProperty("getFingerprint")&&(r=e[n].primaryKey.getFingerprint()),!0===w(r)?t.push(r):i("MSG_NOT_A_FPR")}}return 0===t.length?[]:t}function b(e,t){if(!e||"string"!=typeof e)return!1;if(e.length!==t)return!1;return/^[0-9a-fA-F]*$/i.test(e)}function w(e){return b(e,40)}class P{constructor(){}getKeys(e,t){return new Promise(function(n,r){let o=u("keylist");void 0!==e&&o.setParameter("keys",e),o.setParameter("sigs",!0),o.post().then(function(e){let o=[],i=[];if(0===e.keys.length)n([]);else{for(let n=0;n<e.keys.length;n++){let r=f(e.keys[n].fingerprint);r.setKeyData(e.keys[n]),!0===t&&(i.push(r.getArmor()),i.push(r.getHasSecret())),o.push(r)}i.length>0?Promise.all(i).then(function(){n(o)},function(e){r(e)}):n(o)}})})}getKeysArmored(e){return new Promise(function(t,n){let r=u("export");r.setParameter("armor",!0),void 0!==e&&r.setParameter("keys",e),r.post().then(function(e){t(e.data)},function(e){n(e)})})}getDefaultKey(){let e=this;return new Promise(function(t,n){let r=u("config_opt");r.setParameter("component","gpg"),r.setParameter("option","default-key"),r.post().then(function(r){void 0!==r.value&&r.value.hasOwnProperty("string")&&"string"==typeof r.value.string?e.getKeys(r.value.string,!0).then(function(e){1===e.length?t(e[0]):n(i("KEY_NO_DEFAULT"))},function(e){n(e)}):e.getKeys(null,!0).then(function(e){for(let r=0;r<e.length;r++){if(!0===e[r].get("hasSecret")){t(e[r]);break}r===e.length-1&&n(i("KEY_NO_DEFAULT"))}},function(e){n(e)})},function(e){n(e)})})}importKey(e,t){let n=["considered","no_user_id","imported","imported_rsa","unchanged","new_user_ids","new_sub_keys","new_signatures","new_revocations","secret_read","secret_imported","secret_unchanged","skipped_new_keys","not_imported","skipped_v3_keys"];if(!e||"string"!=typeof e)return Promise.reject(i("PARAM_WRONG"));let r=this;return new Promise(function(o,i){let s=u("import");s.setParameter("data",e),s.post().then(function(e){let s={},a=[];for(let t=0;t<e.result.imports.length;t++){let n=e.result.imports[t],r="";r=0===n.status?"nochange":1==(1&n.status)?"newkey":"change";let o={};o.userId=2==(2&n.status),o.signature=4==(4&n.status),o.subkey=8==(8&n.status),a.push(n.fingerprint),s[n.fingerprint]={changes:o,status:r}}let l=[];if(!0===t)r.getKeys(a,!0).then(function(t){for(let e=0;e<t.length;e++)l.push({key:t[e],changes:s[t[e].fingerprint].changes,status:s[t[e].fingerprint].status});let r={};for(let t=0;t<n.length;t++)r[n[t]]=e[n[t]];o({Keys:l,summary:r})},function(e){i(e)});else{for(let e=0;e<a.length;e++)l.push({key:f(a[e]),changes:s[a[e]].changes,status:s[a[e]].status});o(l)}},function(e){i(e)})})}deleteKey(e){if(!0===w(e)){f(e).delete()}}generateKey(e,t="default",n){if("string"!=typeof e||O.indexOf(t)<0||n&&!(n instanceof Date))return Promise.reject(i("PARAM_WRONG"));let r=this;return new Promise(function(o,i){let s=u("createkey");s.setParameter("userid",e),s.setParameter("algo",t),n&&s.setParameter("expires",Math.floor(n.valueOf()/1e3)),s.post().then(function(e){r.getKeys(e.fingerprint,!0).then(function(e){o(e)},function(e){i(e)})},function(e){i(e)})})}}const O=["default","rsa","rsa2048","rsa3072","rsa4096","dsa","dsa2048","dsa3072","dsa4096","elg","elg2048","elg3072","elg4096","ed25519","cv25519","brainpoolP256r1","brainpoolP384r1","brainpoolP512r1","NIST P-256","NIST P-384","NIST P-521"];function N(e){if("object"!=typeof e||!e.hasOwnProperty("summary")||!e.hasOwnProperty("fingerprint")||!e.hasOwnProperty("timestamp"))return i("SIG_WRONG");let t=Object.keys(e);for(let n=0;n<t.length;n++)if(typeof e[t[n]]!==E[t[n]])return i("SIG_WRONG");let n=Object.keys(e.summary);for(let t=0;t<n.length;t++)if(typeof e.summary[n[t]]!==A[n[t]])return i("SIG_WRONG");if(e.hasOwnProperty("notations")){if(!Array.isArray(e.notations))return i("SIG_WRONG");for(let t=0;t<e.notations.length;t++){let n=e.notations[t],r=Object.keys(n);for(let e=0;e<r.length;e++)if(typeof n[r[e]]!==k[r[e]])return i("SIG_WRONG")}}return console.log("sig created"),new R(e)}class R{constructor(e){this._rawSigObject=e}get fingerprint(){return this._rawSigObject.fingerprint}get expiration(){return this._rawSigObject.exp_timestamp?new Date(1e3*this._rawSigObject.exp_timestamp):null}get timestamp(){return new Date(1e3*this._rawSigObject.timestamp)}get valid(){return!0===this._rawSigObject.valid}get errorDetails(){let e=["revoked","key-expired","sig-expired","key-missing","crl-missing","crl-too-old","bad-policy","sys-error"],t={};for(let n=0;n<e.length;n++)this._rawSigObject.hasOwnProperty(e[n])&&(t[e[n]]=this._rawSigObject[e[n]]);return t}}const E={wrong_key_usage:"boolean",chain_model:"boolean",summary:"object",is_de_vs:"boolean",status_string:"string",fingerprint:"string",validity_string:"string",pubkey_algo_name:"string",hash_algo_name:"string",pka_address:"string",status_code:"number",timestamp:"number",exp_timestamp:"number",pka_trust:"number",validity:"number",validity_reason:"number",notations:"object"},A={valid:"boolean",green:"boolean",red:"boolean",revoked:"boolean","key-expired":"boolean","sig-expired":"boolean","key-missing":"boolean","crl-missing":"boolean","crl-too-old":"boolean","bad-policy":"boolean","sys-error":"boolean",sigsum:"object"},k={human_readable:"boolean",critical:"boolean",name:"string",value:"string",flags:"number"};class G{constructor(){}set Keyring(e){e&&e instanceof P&&(this._Keyring=e)}get Keyring(){return this._Keyring||(this._Keyring=new P),this._Keyring}encrypt(e,t,n,r=!1,o=!0,s=!1,a={}){let l=u("encrypt");if(l instanceof Error)return Promise.reject(l);l.setParameter("armor",o),l.setParameter("always-trust",!0),!0===r&&l.setParameter("base64",!0);let c=h(t);l.setParameter("keys",c);let f=h(n);if(f.length>0&&l.setParameter("signing_keys",f),S(l,e),!0===s&&l.setParameter("throw-keyids",!0),a){let e=Object.keys(a);for(let t=0;t<e.length;t++)l.setParameter(e[t],a[e[t]])}return!0===l.isComplete?l.post():Promise.reject(i("MSG_INCOMPLETE"))}decrypt(e,t=!1){if(void 0===e)return Promise.reject(i("MSG_EMPTY"));let n=u("decrypt");return n instanceof Error?Promise.reject(n):(!0===t&&n.setParameter("base64",!0),S(n,e),!0===t&&n.setParameter("base64",!0),new Promise(function(e,t){n.post().then(function(t){let n={data:t.data};n.base64=!!t.base64,n.is_mime=!!t.mime,t.file_name&&(n.file_name=t.file_name),t.hasOwnProperty("signatures")&&Array.isArray(t.signatures)&&(n.signatures=v(t.signatures)),e(n)},function(e){t(e)})}))}sign(e,t,n="clearsign",r=!1){if(void 0===e)return Promise.reject(i("MSG_EMPTY"));let o=h(t);if(0===o.length)return Promise.reject(i("MSG_NO_KEYS"));let s=u("sign");return s.setParameter("keys",o),!0===r&&s.setParameter("base64",!0),s.setParameter("mode",n),S(s,e),new Promise(function(t,r){"detached"===n&&(s.expect="base64"),s.post().then(function(r){"clearsign"===n?t({data:r.data}):"detached"===n&&t({data:e,signature:r.data})},function(e){r(e)})})}verify(e,t,n=!1){let r=u("verify"),o=S(r,e);if(o instanceof Error)return Promise.reject(o);if(t){if("string"!=typeof t)return Promise.reject(i("PARAM_WRONG"));r.setParameter("signature",t)}return!0===n&&r.setParameter("base64",!0),new Promise(function(e,t){r.post().then(function(n){if(n.info.signatures){let t=v(n.info.signatures);t.is_mime=!!n.info.is_mime,n.info.filename&&(t.file_name=n.info.filename),t.data=n.data,e(t)}else t(i("SIG_NO_SIGS"))},function(e){t(e)})})}}function S(e,t){if(!(e&&e instanceof c))return i("PARAM_WRONG");if(!t)return i("PARAM_WRONG");if("string"==typeof t)e.setParameter("data",t);else{if("object"!=typeof t||"function"!=typeof t.getText)return i("PARAM_WRONG");{let n=t.getText();if("string"!=typeof n)return i("PARAM_WRONG");e.setParameter("data",n)}}}function v(e){if(!Array.isArray(e))return i("SIG_NO_SIGS");let t={all_valid:!1,count:e.length,failures:0,signatures:{good:[],bad:[]}};for(let n=0;n<e.length;n++){let r=N(e[n]);if(r instanceof Error)return i(r);!0!==r.valid?(t.failures+=1,t.signatures.bad.push(r)):t.signatures.good.push(r)}return 0===t.failures&&(t.all_valid=!0),t}t.default={init:function(){return new Promise(function(e,t){(new a).checkConnection(!1).then(function(n){!0===n?e(new G):t(i("CONN_NO_CONNECT"))},function(){t(i("CONN_NO_CONNECT"))})})}}}]).default;